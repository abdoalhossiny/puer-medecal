<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø¨ÙŠÙˆØ± Ù…ÙŠØ¯ÙŠÙƒØ§Ù„</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0; padding: 0;
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      transition: background-image 1s ease-in-out;
      color: #fff;
    }
    header {
      display: flex;
      justify-content: space-between;
      padding: 1rem 2rem;
      background: rgba(0, 0, 0, 0.6);
      font-size: 1.2rem;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }
    .center { text-align: center; padding: 3rem; animation: fadeIn 1s ease; }
    .section {
      display: none;
      padding: 2rem;
      background: rgba(0, 0, 0, 0.6);
      margin: 2rem auto;
      border-radius: 15px;
      width: 90%;
      max-width: 700px;
      animation: fadeIn 0.8s ease;
    }
    input, select {
      width: 100%; padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
    }
    .btn {
      background-color: #28a745;
      color: white;
      padding: 10px 15px;
      border: none;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
      transition: background 0.3s ease;
    }
    .btn:hover { background-color: #218838; }
    .btn-danger { background-color: #dc3545; }
    .btn-warning { background-color: #ffc107; color: black; }
    table {
      width: 100%; margin-top: 1rem;
      border-collapse: collapse;
      background-color: rgba(255,255,255,0.1);
      border-radius: 10px;
      overflow: hidden;
    }
    table, th, td { border: 1px solid #fff; }
    th, td { padding: 10px; text-align: center; }
    .float-end { float: left; }
    .alert-bar {
      background-color: yellow;
      color: red;
      font-weight: bold;
      padding: 10px;
      text-align: center;
    }
    marquee {
      font-size: 1.1rem;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body onload="loadAll()">
  <header>
    <div>ØªÙ… ØªØµÙ…ÙŠÙ… Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ø®Ø± ØªØ­Ø¯ÙŠØ« Ù„ Ø§Ø³Ø¹Ø§Ø± Ø§Ù„Ø¯ÙˆØ§Ø¡ Ø¯Ø§Ø®Ù„ Ù…ØµØ±</div>
  </header>

  <div class="center" id="startPage">
    <h1></h1><h1></h1><h1></h1>
    <button class="btn" onclick="showSection('adminLogin')">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</button>
    <button class="btn btn-warning" onclick="showSection('clientLogin')">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
  </div>

  <div class="section" id="adminLogin">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h2>
    <input type="password" id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" onkeypress="handleEnter(event, adminLogin)">
    <button class="btn" onclick="adminLogin()">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <div class="section" id="clientLogin">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„</h2>
    <input type="text" id="clientPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    <input type="password" id="clientPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" onkeypress="handleEnter(event, clientLogin)">
    <button class="btn" onclick="clientLogin()">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <div class="section" id="adminPanel">
    <h2>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h2>
    <button class="btn float-end" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    <button class="btn btn-warning" onclick="showSection('passManager')">ÙƒÙ„Ù…Ø§Øª Ø³Ø± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
    <input type="text" id="medName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ§Ø¡">
    <input type="text" id="medPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
    <button class="btn" onclick="addMedicine()">Ø¥Ø¶Ø§ÙØ©</button>
    <table id="medTable"><tr><th>Ø§Ù„Ø¯ÙˆØ§Ø¡</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø­Ø°Ù</th></tr></table>
  </div>

  <div class="section" id="passManager">
    <h2>Ø¥Ø¯Ø§Ø±Ø© ÙƒÙ„Ù…Ø§Øª Ø³Ø± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
    <div id="warningBar" class="alert-bar" style="display:none;"></div>
    <button class="btn float-end" onclick="showSection('adminPanel')">ğŸ”™ Ø±Ø¬ÙˆØ¹</button>
    <input type="text" id="newPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    <button class="btn" onclick="generatePassword()">ØªÙˆÙ„ÙŠØ¯ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</button>
    <table id="passTable">
      <tr><th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th><th>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</th><th>ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ</th><th>ØªØ¹Ø¯ÙŠÙ„</th><th>Ø­Ø°Ù</th></tr>
    </table>
  </div>

  <div class="section" id="clientPage">
    <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ø¹Ù…ÙŠÙ„</h2>
    <button class="btn float-end" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    <table id="clientTable">
      <tr><th>Ø§Ù„Ø¯ÙˆØ§Ø¡</th><th>Ø§Ù„Ø³Ø¹Ø±</th></tr>
    </table>
  </div>

  <script>
    let medicines = [];
    let passwords = {};
    const ADMIN_PASSWORD = "121314ahmed";
    const ONE_YEAR_MS = 365 * 24 * 60 * 60 * 1000;

    const backgrounds = [
      'https://images.unsplash.com/photo-1506748686214-e9df14d4d9d0',
      'https://images.unsplash.com/photo-1470770841072-f978cf4d019e',
      'https://images.unsplash.com/photo-1506744038136-46273834b3fb'
    ];

    window.addEventListener('storage', (event) => {
      if (event.key === 'meds') {
        medicines = JSON.parse(event.newValue || '[]');
        renderClientMedicines();
      }
    });

    function setRandomBackground() {
      const img = backgrounds[Math.floor(Math.random() * backgrounds.length)];
      document.body.style.backgroundImage = `url('${img}?auto=format&fit=crop&w=1500&q=80')`;
    }

    function handleEnter(e, callback) {
      if (e.key === "Enter") callback();
    }

    function showSection(id) {
      document.querySelectorAll('.section, .center').forEach(e => e.style.display = 'none');
      document.getElementById(id).style.display = 'block';
      if (id === 'passManager') renderWarnings();
      setRandomBackground();
    }

    function adminLogin() {
      const pass = document.getElementById("adminPass").value;
      if (pass === ADMIN_PASSWORD) {
        showSection("adminPanel");
        renderMedicines();
      } else {
        alert("ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©");
      }
    }

    function clientLogin() {
      const phone = document.getElementById("clientPhone").value;
      const pass = document.getElementById("clientPass").value;
      const info = passwords[phone];
      const now = Date.now();
      if (info && info.pass === pass && now < info.expires) {
        showSection("clientPage");
        renderClientMedicines();
      } else {
        alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ø£Ùˆ Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
      }
    }

    function logout() {
      showSection("startPage");
    }

    function addMedicine() {
      const name = document.getElementById("medName").value;
      const price = document.getElementById("medPrice").value;
      if (name && price) {
        medicines.push({ name, price });
        saveData();
        renderMedicines();
        renderClientMedicines();
      }
    }

    function deleteMedicine(index) {
      if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¯ÙˆØ§Ø¡ØŸ")) {
        medicines.splice(index, 1);
        saveData();
        renderMedicines();
        renderClientMedicines();
      }
    }

    function generatePassword() {
      const phone = document.getElementById("newPhone").value;
      const pass = Math.random().toString(36).substring(2, 8);
      if (phone) {
        passwords[phone] = {
          pass,
          expires: Date.now() + ONE_YEAR_MS
        };
        savePasswords();
        renderPasswords();
        renderWarnings();
        alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: " + pass);
      }
    }

    function editPassword(phone) {
      const newPass = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:", passwords[phone].pass);
      if (newPass) {
        const newPhone = prompt("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯:", phone) || phone;
        const updated = {
          pass: newPass,
          expires: Date.now() + ONE_YEAR_MS
        };
        delete passwords[phone];
        passwords[newPhone] = updated;
        savePasswords();
        renderPasswords();
        renderWarnings();
      }
    }

    function deletePassword(phone) {
      if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ")) {
        delete passwords[phone];
        savePasswords();
        renderPasswords();
        renderWarnings();
      }
    }

    function renderMedicines() {
      const tbl = document.getElementById("medTable");
      tbl.innerHTML = "<tr><th>Ø§Ù„Ø¯ÙˆØ§Ø¡</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø­Ø°Ù</th></tr>";
      medicines.forEach((m, i) => {
        tbl.innerHTML += `<tr><td>${m.name}</td><td>${m.price}</td><td><button class="btn btn-danger" onclick="deleteMedicine(${i})">Ø­Ø°Ù</button></td></tr>`;
      });
    }

    function renderClientMedicines() {
      const tbl = document.getElementById("clientTable");
      tbl.innerHTML = "<tr><th>Ø§Ù„Ø¯ÙˆØ§Ø¡</th><th>Ø§Ù„Ø³Ø¹Ø±</th></tr>";
      medicines.forEach(m => {
        tbl.innerHTML += `<tr><td>${m.name}</td><td>${m.price}</td></tr>`;
      });
    }

    function renderPasswords() {
      const tbl = document.getElementById("passTable");
      tbl.innerHTML = "<tr><th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th><th>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</th><th>ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ</th><th>ØªØ¹Ø¯ÙŠÙ„</th><th>Ø­Ø°Ù</th></tr>";
      for (let phone in passwords) {
        const info = passwords[phone];
        const expired = Date.now() > info.expires;
        const expiryDate = new Date(info.expires).toLocaleDateString();
        tbl.innerHTML += `<tr style="color:${expired ? '#bbb' : '#fff'}">
          <td>${phone}</td><td>${info.pass}</td><td>${expiryDate}</td>
          <td><button class="btn btn-warning" onclick="editPassword('${phone}')">ØªØ¹Ø¯ÙŠÙ„</button></td>
          <td><button class="btn btn-danger" onclick="deletePassword('${phone}')">Ø­Ø°Ù</button></td></tr>`;
      }
    }

    function renderWarnings() {
      const now = Date.now();
      const warningBar = document.getElementById("warningBar");
      let list = [];
      for (let phone in passwords) {
        const exp = passwords[phone].expires;
        if (exp - now <= 30 * 24 * 60 * 60 * 1000 && now < exp) {
          list.push(`âš ï¸ ${phone}`);
        }
      }
      if (list.length) {
        warningBar.innerHTML = `<marquee>âš ï¸ Ø£Ø±Ù‚Ø§Ù… Ø³ØªÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ù‹Ø§: ${list.join(" - ")}</marquee>`;
        warningBar.style.display = "block";
      } else {
        warningBar.style.display = "none";
      }
    }

    function saveData() {
      localStorage.setItem("meds", JSON.stringify(medicines));
    }

    function savePasswords() {
      localStorage.setItem("passes", JSON.stringify(passwords));
    }

    function loadAll() {
      const m = localStorage.getItem("meds");
      const p = localStorage.getItem("passes");
      if (m) medicines = JSON.parse(m);
      if (p) passwords = JSON.parse(p);
      setRandomBackground();
    }
  </script>
</body>
</html>
